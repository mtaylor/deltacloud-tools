package org.jboss.deltacloud.client;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.auth.AuthScope;
import org.apache.http.auth.UsernamePasswordCredentials;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;

public class RESTClient 
{
	public static void main(String[] args) throws Exception
	{
		String username = "WKy3rMzOWPouVOxK1p3Ar1C2uRBwa2FBXnCw";
		String password = "2ILf2maXgZu12KbamJoUgsajBzXeQOyeYHybWg1";
		String scope = "localhost";
		int port = 3003;

        DefaultHttpClient httpclient = new DefaultHttpClient();

        httpclient.getCredentialsProvider().setCredentials(new AuthScope(scope, port), new UsernamePasswordCredentials(username, password));
        
        HttpGet httpget = new HttpGet("http://localhost:3003/api/instances");
        
        System.out.println("executing request" + httpget.getRequestLine());
        
        
        HttpResponse response = httpclient.execute(httpget);
        HttpEntity entity = response.getEntity();

        System.out.println("----------------------------------------");
        System.out.println(response.getStatusLine());
        
        if (entity != null) 
        {
            System.out.println(readInputStreamToString(entity.getContent()));
        }
        if (entity != null) 
        {
            entity.consumeContent();
        }
        httpclient.getConnectionManager().shutdown();        

	}
	
	private static String readInputStreamToString(InputStream is) throws IOException
	{
		if (is != null) 
			{
				StringBuilder sb = new StringBuilder();
				String line;
				try 
				{
					BufferedReader reader = new BufferedReader(new InputStreamReader(is, "UTF-8"));
					while ((line = reader.readLine()) != null) 
					{
						sb.append(line).append("\n");					
					}
			}
			catch(Exception e)
			{
				
			}
			finally
			{
				is.close();
			}
			return sb.toString();
		}
		else
		{
			return "";
		}
	}
}
